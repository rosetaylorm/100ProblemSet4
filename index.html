<!--Taylor Rose, roset@mit.edu, R01, Kelley Vetterman, Problem Set #4-->
<!DOCTYPE html>
<html>

<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<!--<script src="/03_03_07_2014.js"></script-->
<script>

var map;
var overlay;
var context;
var progress = 0;
var buses = [];
var pausedProgress;

function init(){
	var latlng = new google.maps.LatLng(42.3510577,-71.0890165);

	var myOptions = {
		zoom : 14, 
		center : latlng,
		mapTypeId : google.maps.MapTypeId.ROADMAP};

	map = new google.maps.Map(document.getElementById('map'), myOptions);
	
	//add an overlay
	overlay = new google.maps.OverlayView();
	overlay.draw = function(){};
	overlay.setMap(map);
};

function addCanvas(){
	var canvas = document.createElement('canvas');
	canvas.style.position = 'absolute';
	canvas.width = '640';
	canvas.height = '480';
	overlay.getPanes().overlayLayer.appendChild(canvas);

	//get canvas context
	context = canvas.getContext('2d');

	//create start/end for 100 buses
	for (var i = 0; i<100; i++){
		buses.push(createBus());
	}
	//call timer
	timer();
};

function createBus(){

	for (var i=0; i<data.length; i++){ //loop through all data
		if (data.routeTag = 1){ //get all data with routeTag of 1 indicating it is the 1 bus
			for (var j=2121; j<=2290; j++){ //loop through all the 1 buses and the vehicleIds
				if (data.vehicleId = j){ //it then clumps together all the 1 buses with the same vehicleIds
					for (var k=0; k<=86392; k++){ //loop through timeSteps
						data.indexOf(this.data)
					//then find bus at timestep and timestep - 1
					//var getBus = document.getElementById('????');
					//var getPreviousBus = document.getElementById('?????');};};
		};
		var start = {
			x : //the longitude of the bus at the previous time step getPreviousBus.lon,
			y : //the lattitude of the bus at the previous time step getPreviousBus.lat
		}

		var end = {
			x : //the longtitude of the bus at the current time step getBus.lon,
			y : //the lattitude of the bus at the current time step getBus.lat
		}
	/*var start = {
		x : Math.floor(Math.random()*640),
		y : Math.floor(Math.random()*480)
	};

	var end = {
		x : Math.floor(Math.random()*640),
		y : Math.floor(Math.random()*480)
	};*/

	var fillStyle = 'rgba('+ Math.floor(Math.random()*255) + ','+ Math.floor(Math.random()*255) + ','+ Math.floor(Math.random()*255) + ', .5)';
	/*to color code the bus: create a for loop with an if statement inside:
	for (var i = 0; i < largest bus number; i++){
		busRouteNumber = getElementByID('id').routeNum (or something like that);
		color = 'rgba('+ Math.floor(Math.random()*255) + ','+ Math.floor(Math.random()*255) + ','+ Math.floor(Math.random()*255) + ', .5)';
		var fillStyle = color;
	}; */

	var currentPosition = function(){
		var current = {};
		current.x = start.x + (end.x - start.x)*progress;
		current.y = start.y + (end.y - start.y)*progress;
		return current;
	};
	
	return {
		start : start,
		end : end, 
		fillStyle : fillStyle, 
		currentPosition : currentPosition
	};
};

function timer(){
	progress += 0.05;
	if (progress < 1){
		drawBus();
		setTimeout(timer, 15);
	}
};

function pause(){
	pausedProgress = progress;
	progress = 1;
}

function continue(){
	progress = pausedProgress;
	timer();
}

function drawBus(){
	
	var x;
	var y;
	var current;
	var r = 5;
	var length = buses.length;

	for (var i=0; i<length; i++){
		current = buses[i].currentPosition(progress);
		context.fillStyle = buses[i].fillStyle;
		context.beginPath();
		context.arc(current.x, current.y, r, 0, Math.PI*2, true)
		context.closePath();
		context.fill();
	};
};


google.maps.event.addDomListener(window, 'load', init);

</script>
<input type="button" value="Start"  onclick= "addCanvas()" />
<input type="button" value="Pause"  onclick= "pause()" /> 
<input type="button" value="Continue"  onclick= "continue()" />
<div id = 'map' style = 'height: 480px; width: 640px'></div>
<!--to display current time, call bus.local-->

</html>
