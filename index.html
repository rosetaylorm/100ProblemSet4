<!--Taylor Rose, roset@mit.edu, R01, Kelley Vetterman, Problem Set #4-->
<!DOCTYPE html>
<html>

<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<!--<script src="/03_03_07_2014.js"></script-->
<script>

var map;
var overlay;
var context;
var progress = 0;
var buses = [];

function init(){
	var latlng = new google.maps.LatLng(42.3510577,-71.0890165);

	var myOptions = {
		zoom : 14, 
		center : latlng,
		mapTypeId : google.maps.MapTypeId.ROADMAP};

	map = new google.maps.Map(document.getElementById('map'), myOptions);
	
	//add an overlay
	overlay = new google.maps.OverlayView();
	overlay.draw = function(){};
	overlay.setMap(map);
};

function addCanvas(){
	var canvas = document.createElement('canvas');
	canvas.style.position = 'absolute';
	canvas.width = '640';
	canvas.height = '480';
	overlay.getPanes().overlayLayer.appendChild(canvas);

	//get canvas context
	context = canvas.getContext('2d');

	//create start/end for 100 buses
	for (var i = 0; i<100; i++){
		buses.push(createBus());
	}
	//call timer
	timer();
};

function createBus(){
	var start = {
		x : Math.floor(Math.random()*640),
		y : Math.floor(Math.random()*480)
	};

	var end = {
		x : Math.floor(Math.random()*640),
		y : Math.floor(Math.random()*480)
	};

	var fillStyle = 'rgba('+ Math.floor(Math.random()*255) + ','+ Math.floor(Math.random()*255) + ','+ Math.floor(Math.random()*255) + ', .5)';

	var currentPosition = function(){
		var current = {};
		current.x = start.x + (end.x - start.x)*progress;
		current.y = start.y + (end.y - start.y)*progress;
		return current;
	};
	
	return {
		start : start,
		end : end, 
		fillStyle : fillStyle, 
		currentPosition : currentPosition
	};
};

function timer(){
	progress += 0.05;
	if (progress < 1){
		drawBus();
		setTimeout(timer, 15);
	}
};

function drawBus(){
	
	var x;
	var y;
	var current;
	var r = 5;

	var length = buses.length;
	for (var i=0; i<length; i++){
		current = buses[i].currentPosition(progress);
		context.fillStyle = buses[i].fillStyle;
		context.beginPath();
		context.arc(current.x, current.y, r, 0, Math.PI*2, true)
		context.closePath();
		context.fill();
	};
};


google.maps.event.addDomListener(window, 'load', init);

</script>
<input type="button" value="Start"  onclick= "addCanvas()" />
<input type="button" value="Pause"  onclick= "" /> <!--need to decide function here-->
<input type="button" value="Continue"  onclick= "" /> <!--need to decide function here-->
<div id = 'map' style = 'height: 480px; width: 640px'></div>

</html>
